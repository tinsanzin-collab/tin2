<!DOCTYPE html>
<html lang="bo">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡Ω¶‡Ω¥‡Ωò‡ºã‡ΩÖ‡Ω¥‡ºã‡Ωñ‡Ω†‡Ω≤‡ºã‡Ω¶‡æ¶‡æ±‡Ωº‡ΩÑ‡ºã‡Ωñ‡Ω¢‡æ°‡Ω¢‡ºç - Tibetan Grammar Game</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Jomolhari&display=swap');

        body {
            font-family: 'Jomolhari', serif;
            background-color: #fdf6e3;
            color: #2c3e50;
        }

        .tibetan-text {
            font-family: 'Jomolhari', serif;
            line-height: 1.6;
        }

        /* Custom Animations */
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .slide-in {
            animation: slideIn 0.3s ease-out forwards;
        }

        .correct-anim {
            background-color: #d1fae5 !important;
            border-color: #10b981 !important;
            transform: scale(1.02);
            transition: all 0.2s;
        }

        .wrong-anim {
            background-color: #fee2e2 !important;
            border-color: #ef4444 !important;
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <!-- Game Container -->
    <div id="game-app" class="w-full max-w-2xl bg-white rounded-2xl shadow-xl overflow-hidden border-t-8 border-indigo-600">
        
        <!-- Header -->
        <header class="bg-slate-50 p-6 border-b border-slate-100 flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-bold text-indigo-800 mb-1">‡Ω¶‡Ω¥‡Ωò‡ºã‡ΩÖ‡Ω¥‡ºã‡Ωñ‡Ω†‡Ω≤‡ºã‡Ω¢‡æ©‡Ω∫‡Ωë‡ºã‡Ωê‡ΩÑ‡ºã‡ºç</h1>
                <p class="text-gray-500 text-sm">Tibetan Grammar Practice</p>
            </div>
            <div class="text-right">
                <div class="text-sm font-semibold text-gray-400">‡Ω¶‡æê‡Ω¥‡ΩÇ‡Ω¶‡ºã‡Ωê‡Ωº‡Ωñ‡ºç Score</div>
                <div class="text-2xl font-bold text-indigo-600" id="score-display">0</div>
            </div>
        </header>

        <!-- Progress Bar -->
        <div class="w-full bg-gray-200 h-2">
            <div id="progress-bar" class="bg-indigo-500 h-2 transition-all duration-500" style="width: 0%"></div>
        </div>

        <!-- Level Indicator -->
        <div class="bg-indigo-50 px-6 py-2 flex justify-between items-center">
            <span id="level-badge" class="px-3 py-1 bg-indigo-200 text-indigo-800 rounded-full text-sm font-bold">‡Ω¢‡Ω≤‡Ωò‡ºã‡Ωî‡ºã‡Ωë‡ΩÑ‡ºã‡Ωî‡Ωº‡ºç Level 1</span>
            <span id="streak-badge" class="text-sm text-indigo-600 font-semibold hidden">üî• Streak: 0</span>
        </div>

        <!-- Main Content Area -->
        <main class="p-8 min-h-[400px] flex flex-col justify-center relative">
            
            <!-- Question Section -->
            <div id="question-container" class="slide-in text-center">
                <h2 id="question-prompt" class="text-xl text-gray-600 mb-6 font-bold"></h2>
                
                <div id="question-display" class="text-4xl md:text-5xl font-bold text-gray-800 mb-10 p-6 bg-slate-50 rounded-xl border border-slate-200 shadow-inner">
                    <!-- Dynamic Question Text -->
                </div>

                <!-- Options Grid -->
                <div id="options-grid" class="grid grid-cols-2 md:grid-cols-3 gap-4">
                    <!-- Dynamic Options -->
                </div>
            </div>

            <!-- Feedback Overlay (Hidden by default) -->
            <div id="feedback-overlay" class="absolute inset-0 bg-white/95 backdrop-blur-sm z-10 flex flex-col items-center justify-center hidden">
                <div id="feedback-icon" class="text-6xl mb-4">‚úÖ</div>
                <h3 id="feedback-title" class="text-2xl font-bold mb-2">‡Ω†‡ΩÇ‡æ≤‡Ω≤‡ΩÇ‡ºã‡Ω¶‡Ωº‡ΩÑ‡ºã‡ºç Correct!</h3>
                <p id="feedback-text" class="text-lg text-center max-w-md text-gray-600 mb-6 px-4"></p>
                <button id="next-btn" class="px-8 py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-bold text-xl transition-colors shadow-lg">
                    ‡Ωò‡Ω¥‡ºã‡Ωò‡Ωê‡Ω¥‡Ωë‡ºç Next
                </button>
            </div>

            <!-- Level Complete Screen (Hidden) -->
            <div id="level-complete" class="hidden text-center slide-in">
                <div class="text-6xl mb-4">üéâ</div>
                <h2 class="text-3xl font-bold text-gray-800 mb-4">‡Ω¢‡Ω≤‡Ωò‡ºã‡Ωî‡ºã‡Ω£‡Ω∫‡ΩÇ‡Ω¶‡ºã‡ΩÇ‡æ≤‡Ω¥‡Ωñ‡ºç</h2>
                <p class="text-xl text-gray-600 mb-8">Level Complete!</p>
                <button id="next-level-btn" class="px-8 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-bold text-xl transition-colors shadow-lg">
                    ‡Ω¢‡Ω≤‡Ωò‡ºã‡Ωî‡ºã‡Ω¢‡æó‡Ω∫‡Ω¶‡ºã‡Ωò‡ºç Start Next Level
                </button>
            </div>

        </main>

        <!-- Footer -->
        <footer class="bg-slate-50 p-4 text-center border-t border-slate-100 text-gray-400 text-sm">
            ‡Ω¢‡æ©‡Ωº‡Ωò‡ºã‡Ω°‡Ω≤‡ΩÇ‡ºã‡Ωû‡Ω¥‡ºã‡Ωë‡ΩÇ‡ºã‡Ωë‡ΩÑ‡ºã‡Ω¶‡Ω¥‡Ωò‡ºã‡ΩÖ‡Ω¥‡ºã‡Ωñ‡Ω†‡Ω≤‡ºã‡Ω¢‡æ£‡Ωò‡ºã‡ΩÇ‡Ωû‡ΩÇ
        </footer>
    </div>

    <script>
        // --- 1. GAME DATA & VOCABULARY ENGINE ---
        // To make it "infinite", we use lists of words sorted by their suffix (Rjes-'jug).
        
        const suffixes = {
            'g': ['‡Ω¢‡æü‡ΩÇ', '‡Ω£‡ΩÇ', '‡Ωö‡Ω≤‡ΩÇ', '‡Ωñ‡Ωë‡ΩÇ', '‡Ωï‡æ±‡ΩÇ', '‡Ωò‡Ωá‡Ω¥‡ΩÇ', '‡Ω£‡Ω¥‡ΩÇ', '‡Ωë‡Ω¥‡ΩÇ'],
            'ng': ['‡Ωñ‡Ωü‡ΩÑ', '‡ΩÇ‡ΩÑ', '‡Ωë‡Ωñ‡æ±‡ΩÑ‡Ω¶', '‡Ωì‡ΩÑ', '‡Ωò‡Ω≤‡ΩÑ', '‡Ωû‡Ω≤‡ΩÑ', '‡Ω¢‡æê‡ΩÑ', '‡ΩÅ‡Ωº‡ΩÑ'],
            'd': ['‡Ω°‡Ωº‡Ωë', '‡Ωñ‡Ω§‡Ωë', '‡Ω¶‡æê‡Ωë', '‡Ωì‡Ωë', '‡Ωñ‡Ω¢‡æó‡Ωº‡Ωë', '‡Ω¶‡æ®‡Ωì', '‡Ω¢‡æí‡Ωë'], // Note: Da/Na distinctions in usage
            'n': ['‡Ω°‡Ω≤‡Ωì', '‡Ω¶‡æ®‡Ωì', '‡Ωë‡Ωº‡Ωì', '‡Ωñ‡Ω¶‡æü‡Ωì', '‡Ωò‡ΩÇ‡æ≤‡Ωº‡Ωì', '‡Ω¶‡æ§‡æ±‡Ωì', '‡ΩÇ‡Ωû‡Ωì'],
            'b': ['‡Ωê‡Ωº‡Ωñ', '‡ΩÅ‡Ωñ', '‡Ω¶‡æí‡æ≤‡Ω¥‡Ωñ', '‡Ω¶‡æ≥‡Ωº‡Ωñ', '‡Ω°‡Ωñ', '‡ΩÇ‡æ≤‡Ω¥‡Ωñ', '‡Ωï‡Ω∫‡Ωñ‡Ω¶'], // Phebs has 's', special handling
            'm': ['‡Ω£‡Ωò', '‡ΩÅ‡Ωò', '‡ΩÇ‡Ωè‡Ωò', '‡Ω¶‡æí‡Ωº‡Ωò', '‡Ωñ‡Ω¶‡Ωò', '‡Ω†‡Ωõ‡Ωº‡Ωò', '‡Ω¢‡æ£‡Ωò'],
            'a': ['‡Ωë‡ΩÇ‡Ω†', '‡Ωñ‡ΩÄ‡Ω†', '‡Ωò‡ΩÅ‡Ω†', '‡Ωá', '‡Ωâ', '‡Ωü‡æ≥‡ºã‡Ωñ', '‡Ωâ‡Ω≤‡ºã‡Ωò'], // 'a and mtha'-med
            'r': ['‡Ω†‡ΩÇ‡æ±‡Ω¥‡Ω¢', '‡ΩÇ‡Ω¶‡Ω∫‡Ω¢', '‡Ωë‡Ω¢', '‡Ω¶‡æ¶‡æ±‡Ωº‡Ω¢', '‡Ω†‡Ωñ‡Ω¢', '‡Ω§‡Ω¢', '‡Ωë‡ΩÄ‡Ω¢'],
            'l': ['‡Ω°‡Ω¥‡Ω£', '‡Ωñ‡Ω£‡ºã', '‡Ω†‡ΩÅ‡æ≤‡Ω¥‡Ω£', '‡Ω¢‡Ω£', '‡Ωò‡Ωá‡Ω£', '‡ΩÇ‡Ω¶‡Ωº‡Ω£', '‡Ωû‡Ω£'],
            's': ['‡Ω§‡Ω∫‡Ω¶', '‡Ω¢‡Ω≤‡ΩÇ‡Ω¶', '‡ΩÇ‡Ωº‡Ω¶', '‡Ω£‡Ω¶', '‡ΩÜ‡Ωº‡Ω¶', '‡Ωë‡Ωñ‡Ω¥‡Ω¶', '‡ΩÇ‡Ωì‡Ω¶'],
            't': [] // Da-drag is rare in modern simple context, usually treated as specific cases
        };

        // Grammar Rules Engine
        const grammarRules = {
            // Slardu (Sentence Ending)
            getSlardu: (suffix) => {
                if (['g'].includes(suffix)) return '‡ΩÇ‡Ωº';
                if (['ng'].includes(suffix)) return '‡ΩÑ‡Ωº';
                if (['d'].includes(suffix)) return '‡Ωë‡Ωº';
                if (['n'].includes(suffix)) return '‡Ωì‡Ωº';
                if (['b'].includes(suffix)) return '‡Ωñ‡Ωº';
                if (['m'].includes(suffix)) return '‡Ωò‡Ωº';
                if (['a', 'r', 'l'].includes(suffix)) return suffix === 'a' ? '‡Ω†‡Ωº' : (suffix === 'r' ? '‡Ω¢‡Ωº' : '‡Ω£‡Ωº');
                if (['s'].includes(suffix)) return '‡Ω¶‡Ωº';
                return '‡Ω†‡Ωº'; // Default/Vowel
            },
            
            // 'Brel-sgra (Of) / Byed-sgra (By) - Simplified mapping
            getBrelSgra: (suffix) => {
                // Gi, Kyi, Gyi, 'i, Yi
                if (['g', 'ng'].includes(suffix)) return '‡ΩÇ‡Ω≤';
                if (['d', 'b', 's'].includes(suffix)) return '‡ΩÄ‡æ±‡Ω≤';
                if (['n', 'm', 'r', 'l'].includes(suffix)) return '‡ΩÇ‡æ±‡Ω≤';
                if (['a'].includes(suffix)) return '‡Ω°‡Ω≤'; // Or 'i depending on context, using Yi for clarity
                return '‡Ω°‡Ω≤';
            },

            getByedSgra: (suffix) => {
                // Gis, Kyis, Gyis, 'is, Yis
                if (['g', 'ng'].includes(suffix)) return '‡ΩÇ‡Ω≤‡Ω¶';
                if (['d', 'b', 's'].includes(suffix)) return '‡ΩÄ‡æ±‡Ω≤‡Ω¶';
                if (['n', 'm', 'r', 'l'].includes(suffix)) return '‡ΩÇ‡æ±‡Ω≤‡Ω¶';
                if (['a'].includes(suffix)) return '‡Ω°‡Ω≤‡Ω¶'; 
                return '‡Ω°‡Ω≤‡Ω¶';
            },

            // La-don (To, In, At)
            getLaDon: (suffix) => {
                // Su, Ra, Ru, Du, Na, La, Tu
                if (['s'].includes(suffix)) return '‡Ω¶‡Ω¥';
                if (['g', 'b'].includes(suffix)) return '‡Ωè‡Ω¥'; // Da-drag also Tu
                if (['ng', 'd', 'n', 'm', 'r', 'l'].includes(suffix)) return '‡Ωë‡Ω¥';
                if (['a'].includes(suffix)) return '‡Ω¢‡Ω¥'; // or Ra
                return '‡Ω¢‡Ω¥';
            },

            // Lhag-chas (Te, De, Ste)
            getLhagChas: (suffix) => {
                if (['n', 'r', 'l', 's'].includes(suffix)) return '‡Ωè‡Ω∫';
                if (['d'].includes(suffix)) return '‡Ωë‡Ω∫';
                if (['g', 'ng', 'b', 'm', 'a'].includes(suffix)) return '‡Ω¶‡æü‡Ω∫'; // Note: Sa-mthar-ste rules vary by grammar school slightly, using standard modern simple rule.
                // Standard: Ga Nga Ba Ma 'A -> Ste. 
                return '‡Ω¶‡æü‡Ω∫';
            }
        };

        // --- 2. GENERATORS FOR ENDLESS CONTENT ---

        // Helper: Get suffix of a word
        function identifySuffix(word) {
            // Very basic suffix identification logic for the provided vocabulary lists
            // In a real app, this would need complex unicode analysis.
            // Here, we reverse map our vocabulary lists.
            for (const [suf, words] of Object.entries(suffixes)) {
                if (words.includes(word)) return suf;
            }
            // Fallback for visual cues
            const lastChar = word.slice(-1);
            if (lastChar === '‡ΩÇ') return 'g';
            if (lastChar === '‡ΩÑ') return 'ng';
            if (lastChar === '‡Ωë') return 'd';
            if (lastChar === '‡Ωì') return 'n';
            if (lastChar === '‡Ωñ') return 'b';
            if (lastChar === '‡Ωò') return 'm';
            if (lastChar === '‡Ω¢') return 'r';
            if (lastChar === '‡Ω£') return 'l';
            if (lastChar === '‡Ω¶') return 's';
            return 'a'; // Default vowel ending
        }

        // Level 1: Slardu
        function generateLevel1() {
            // Pick random word
            const allWords = Object.values(suffixes).flat();
            const word = allWords[Math.floor(Math.random() * allWords.length)];
            const suffix = identifySuffix(word);
            const correctAnswer = grammarRules.getSlardu(suffix);
            
            // Generate options
            const allSlardu = ['‡ΩÇ‡Ωº', '‡ΩÑ‡Ωº', '‡Ωë‡Ωº', '‡Ωì‡Ωº', '‡Ωñ‡Ωº', '‡Ωò‡Ωº', '‡Ω†‡Ωº', '‡Ω¢‡Ωº', '‡Ω£‡Ωº', '‡Ω¶‡Ωº', '‡Ωè‡Ωº'];
            const options = [correctAnswer];
            while(options.length < 4) {
                const rand = allSlardu[Math.floor(Math.random() * allSlardu.length)];
                if(!options.includes(rand)) options.push(rand);
            }
            
            return {
                prompt: "‡ΩÇ‡Ω§‡Ωò‡ºã‡ΩÇ‡æ±‡Ω≤‡ºã‡Ωò‡Ω≤‡ΩÑ‡ºã‡Ωö‡Ω≤‡ΩÇ‡ºã‡Ω£‡ºã‡Ω¢‡Ωì‡ºã‡Ωî‡Ω†‡Ω≤‡ºã‡Ω¶‡æ≥‡Ω¢‡ºã‡Ωñ‡Ω¶‡æ°‡Ω¥‡ºã‡Ω†‡Ωë‡Ω∫‡Ωò‡Ω¶‡ºã‡Ω¢‡Ωº‡ΩÇ‡Ω¶‡ºç",
                questionHtml: `${word}____`,
                answer: correctAnswer,
                options: options.sort(() => Math.random() - 0.5),
                explanation: `‡Ω¢‡æó‡Ω∫‡Ω¶‡ºã‡Ω†‡Ωá‡Ω¥‡ΩÇ‡ºã '${suffix === 'a' ? '‡Ωò‡Ωê‡Ω†‡ºã‡Ωò‡Ω∫‡Ωë' : suffix}' ‡Ω°‡Ω≤‡Ωì‡ºã‡Ωî‡Ω¶‡ºã '${correctAnswer}' ‡Ωê‡Ωº‡Ωñ‡ºç`
            };
        }

        // Level 2: Connective Particles ('Brel-sgra / Byed-sgra / La-don)
        function generateLevel2() {
            const types = ['brel', 'byed', 'ladon'];
            const type = types[Math.floor(Math.random() * types.length)];
            
            const allWords = Object.values(suffixes).flat();
            const word = allWords[Math.floor(Math.random() * allWords.length)];
            const suffix = identifySuffix(word);
            
            let correctAnswer, options, contextWord;
            
            if (type === 'brel') {
                correctAnswer = grammarRules.getBrelSgra(suffix);
                contextWord = "‡Ωò‡Ωë‡Ωº‡ΩÇ"; // Color (generic object)
                options = ['‡ΩÇ‡Ω≤', '‡ΩÄ‡æ±‡Ω≤', '‡ΩÇ‡æ±‡Ω≤', '‡Ω°‡Ω≤', '‡Ω†‡Ω≤'].sort(() => Math.random() - 0.5).slice(0, 4);
                if (!options.includes(correctAnswer)) options[0] = correctAnswer;
            } else if (type === 'byed') {
                correctAnswer = grammarRules.getByedSgra(suffix);
                contextWord = "‡Ωñ‡Ω§‡Ωë‡ºç"; // Said (generic verb)
                options = ['‡ΩÇ‡Ω≤‡Ω¶', '‡ΩÄ‡æ±‡Ω≤‡Ω¶', '‡ΩÇ‡æ±‡Ω≤‡Ω¶', '‡Ω°‡Ω≤‡Ω¶', '‡Ω†‡Ω≤‡Ω¶'].sort(() => Math.random() - 0.5).slice(0, 4);
                if (!options.includes(correctAnswer)) options[0] = correctAnswer;
            } else {
                correctAnswer = grammarRules.getLaDon(suffix);
                contextWord = "‡Ωï‡æ±‡Ω≤‡Ωì‡ºç"; // Went (generic verb)
                options = ['‡Ω¶‡Ω¥', '‡Ω¢‡Ω¥', '‡Ωë‡Ω¥', '‡Ωè‡Ω¥', '‡Ωì'].sort(() => Math.random() - 0.5).slice(0, 4);
                if (!options.includes(correctAnswer)) options[0] = correctAnswer;
            }

            return {
                prompt: "‡Ωñ‡Ω¢‡ºã‡ΩÇ‡æ±‡Ω≤‡ºã‡Ω¶‡æü‡Ωº‡ΩÑ‡ºã‡ΩÜ‡Ω†‡Ω≤‡ºã‡Ωì‡ΩÑ‡ºã‡Ω£‡ºã‡Ωï‡æ≤‡Ωë‡ºã‡Ω¢‡Ωì‡ºã‡Ωî‡ºã‡Ωû‡Ω≤‡ΩÇ‡ºã‡Ω†‡Ωë‡Ω∫‡Ωò‡Ω¶‡ºã‡Ω¢‡Ωº‡ΩÇ‡Ω¶‡ºç",
                questionHtml: `<span class="text-indigo-600">${word}</span> ____ <span class="text-gray-500">${contextWord}</span>`,
                answer: correctAnswer,
                options: options.sort(() => Math.random() - 0.5),
                explanation: `‡Ωò‡Ω≤‡ΩÑ‡ºã‡Ω¶‡æî‡ºã‡Ωò‡Ω†‡Ω≤‡ºã‡Ω¢‡æó‡Ω∫‡Ω¶‡ºã‡Ω†‡Ωá‡Ω¥‡ΩÇ‡ºã '${suffix}' ‡Ω°‡Ω≤‡Ωì‡ºã‡Ωî‡Ω¶‡ºã '${correctAnswer}' ‡Ω†‡Ωê‡Ωº‡Ωñ‡ºç`
            };
        }

        // Level 3: Sentence Building (Simple Context)
        function generateLevel3() {
            // Expanded Templates allowing for Ni, Dang, etc.
            const templates = [
                { q: "‡Ωñ‡ΩÄ‡æ≤‡ºã‡Ω§‡Ω≤‡Ω¶‡ºã ____ ‡Ωñ‡Ωë‡Ω∫‡ºã‡Ω¶‡æê‡æ±‡Ω≤‡Ωë‡ºã‡ΩÇ‡Ωâ‡Ω≤‡Ω¶‡ºã‡Ω¶‡æ≥‡Ωº‡Ωñ‡ºã‡ΩÇ‡æ≤‡æ≠‡Ω¢‡ºã‡Ωï‡æ±‡Ω≤‡Ωì‡ºç", a: "‡Ωë‡ΩÑ‡ºã", opts: ["‡Ωë‡ΩÑ‡ºã", "‡Ωì‡Ω≤‡ºã", "‡ΩÇ‡Ω≤‡Ω¶", "‡Ω£‡ºã"], expl: "‡Ωò‡Ω≤‡ΩÑ‡ºã‡ΩÇ‡Ωâ‡Ω≤‡Ω¶‡ºã‡Ω¶‡æ°‡Ω¥‡Ωë‡ºã‡Ωî‡ºã‡Ω£‡ºã '‡Ωë‡ΩÑ‡ºã' ‡Ω¶‡æí‡æ≤‡ºã‡Ω†‡Ωá‡Ω¥‡ΩÇ" },
                { q: "‡ΩÅ‡Ωº‡ΩÑ‡ºã ____ ‡Ωë‡ΩÇ‡Ω∫‡ºã‡Ω¢‡æí‡Ωì‡ºã‡Ωñ‡Ωü‡ΩÑ‡ºã‡Ωî‡Ωº‡ºã‡Ωû‡Ω≤‡ΩÇ‡ºã‡Ω¢‡Ω∫‡Ωë‡ºç", a: "‡Ωì‡Ω≤‡ºã", opts: ["‡Ωì‡Ω≤‡ºã", "‡Ωë‡ΩÑ‡ºã", "‡Ωì‡Ω¶", "‡Ω£‡Ω¶"], expl: "‡Ωñ‡Ω¢‡æó‡Ωº‡Ωë‡ºã‡ΩÇ‡Ωû‡Ω≤‡ºã‡ΩÇ‡Ωô‡Ωº‡ºã‡Ωñ‡Ωº‡Ω¢‡ºã‡Ω†‡Ωë‡Ωº‡Ωì‡ºã‡Ωî‡Ω¶‡ºã '‡Ωì‡Ω≤‡ºã' ‡Ω¶‡æí‡æ≤‡ºã‡Ω†‡Ωá‡Ω¥‡ΩÇ" },
                { q: "‡ΩÑ‡ºã‡Ωì‡ΩÑ‡ºã ____ ‡Ωï‡æ±‡Ω≤‡ºã‡Ω£‡ºã‡Ωê‡Ωº‡Ωì‡ºç", a: "‡Ωì‡Ω¶", opts: ["‡Ωì‡Ω¶", "‡Ω£‡Ω¶", "‡Ωì‡Ω≤", "‡ΩÄ‡æ±‡ΩÑ"], expl: "‡Ω†‡Ωñ‡æ±‡Ω¥‡ΩÑ‡ºã‡ΩÅ‡Ω¥‡ΩÑ‡Ω¶‡ºã‡Ω¶‡æü‡Ωº‡Ωì‡ºã‡Ωî‡Ω¶‡ºã '‡Ωì‡Ω¶‡ºã' ‡Ω¶‡æí‡æ≤‡ºã‡Ω†‡Ωê‡Ωº‡Ωñ‡ºç" },
                { q: "‡Ω£‡æï‡ΩÇ‡Ω¶‡ºã ____ ‡ΩÇ‡Ω¶‡Ω∫‡Ω¢‡ºã‡Ω¢‡æ©‡ºã‡ΩÜ‡Ω∫‡ºç", a: "‡Ω£‡Ω¶", opts: ["‡Ω£‡Ω¶", "‡Ωì‡Ω¶", "‡ΩÄ‡æ±‡ΩÑ", "‡Ω¶‡æü‡Ω∫"], expl: "‡Ωë‡ΩÇ‡Ω¢‡ºã‡Ωñ‡ºã (comparison) ‡Ω°‡Ω≤‡Ωì‡ºã‡Ωî‡Ω¶‡ºã '‡Ω£‡Ω¶‡ºã' ‡Ω¶‡æí‡æ≤‡ºã‡Ω†‡Ωê‡Ωº‡Ωñ‡ºç" },
                { q: "‡ΩÅ‡æ≤‡Ωº‡Ωò‡ºã ____ ‡Ωò‡Ω≤‡ºã‡Ωò‡ΩÑ‡ºã‡Ωî‡Ωº‡ºã‡Ω†‡Ωë‡Ω¥‡ΩÇ", a: "‡Ω£‡ºã", opts: ["‡Ω£‡ºã", "‡Ωì‡Ω¶", "‡ΩÇ‡Ω≤", "‡ΩÄ‡æ±‡Ω≤"], expl: "‡ΩÇ‡Ωì‡Ω¶‡ºã‡ΩÇ‡Ωû‡Ω≤‡ºã‡Ω¶‡æü‡Ωº‡Ωì‡ºã‡Ωî‡Ω†‡Ω≤‡ºã‡Ω£‡ºã‡Ωë‡Ωº‡Ωì‡ºã‡ΩÇ‡æ±‡Ω≤‡ºã‡Ωï‡æ≤‡Ωë‡ºã‡Ωë‡ΩÇ‡Ωº‡Ω¶‡ºç" },
                { q: "‡Ωâ‡Ω≤‡ºã‡Ωò‡ºã ____ ‡Ω†‡Ωº‡Ωë‡ºã‡Ωü‡Ω∫‡Ω¢‡ºã‡Ω†‡Ωï‡æ≤‡Ωº‡Ω¶‡ºç", a: "‡Ω°‡Ω≤‡Ω¶‡ºã", opts: ["‡Ω°‡Ω≤‡Ω¶‡ºã", "‡Ωì‡Ω≤", "‡Ω£", "‡Ωè‡Ω¥"], expl: "‡Ωñ‡æ±‡ºã‡Ωñ‡ºã‡Ωñ‡æ±‡Ω∫‡Ωë‡ºã‡Ωò‡ΩÅ‡Ωì‡ºã‡Ω°‡Ω≤‡Ωì‡ºã‡Ωî‡Ω¶‡ºã‡Ωñ‡æ±‡Ω∫‡Ωë‡ºã‡Ω¶‡æí‡æ≤‡ºã‡Ωë‡ΩÇ‡Ωº‡Ω¶‡ºç" },
                { q: "‡Ω§‡Ω≤‡ΩÑ‡ºã‡Ωè‡Ωº‡ΩÇ‡ºã‡Ω†‡Ωë‡Ω≤‡ºã‡Ωû‡Ω≤‡Ωò‡ºã‡Ωî‡Ωº‡ºã‡Ωò‡Ω∫‡Ωë‡ºã ____ ‡Ωò‡Ωë‡Ωº‡ΩÇ‡ºã‡ΩÅ‡ºã‡Ω£‡Ω∫‡ΩÇ‡Ω¶‡ºã‡Ωî‡Ωº‡ºã‡Ω†‡Ωë‡Ω¥‡ΩÇ", a: "‡ΩÄ‡æ±‡ΩÑ‡ºã", opts: ["‡ΩÄ‡æ±‡ΩÑ‡ºã", "‡Ωì‡Ω¶", "‡Ω£‡Ω¶", "‡Ωì‡Ω≤"], expl: "‡Ωò‡Ωê‡Ω¥‡Ωì‡ºã‡Ωò‡Ω≤‡Ωì‡ºã‡ΩÇ‡æ±‡Ω≤‡ºã‡Ωö‡Ω≤‡ΩÇ‡ºã‡Ω¢‡æí‡æ±‡Ωì‡ºã‡Ω¶‡æ°‡Ω¥‡Ωë‡ºã‡Ωî‡Ω¶‡ºã '‡ΩÄ‡æ±‡ΩÑ‡ºã' ‡Ω¶‡æí‡æ≤‡ºã‡Ω†‡Ωê‡Ωº‡Ωñ‡ºç" },
                { q: "‡Ωë‡Ω∫‡Ωñ‡ºã‡Ω†‡Ωë‡Ω≤‡ºã‡Ω¶‡Ω¥‡ºã ____ ‡Ω¢‡Ω∫‡Ωë‡ºç", a: "‡Ω°‡Ω≤‡ºã", opts: ["‡Ω°‡Ω≤‡ºã", "‡Ω°‡Ω≤‡Ω¶", "‡Ωì‡Ω¶", "‡Ω£‡Ω¶"], expl: "‡Ωë‡Ωñ‡ΩÑ‡ºã‡Ωñ‡ºã‡Ω¶‡æü‡Ωº‡Ωì‡ºã‡Ωî‡Ω†‡Ω≤‡ºã‡Ω†‡Ωñ‡æ≤‡Ω∫‡Ω£‡ºã‡Ω¶‡æí‡æ≤‡ºã‡Ωë‡ΩÇ‡Ωº‡Ω¶‡ºç" },
                { q: "‡ΩÜ‡Ω¢‡ºã‡Ωî‡ºã‡Ωñ‡Ωñ‡Ω¶‡ºã ____ ‡ΩÇ‡Ωì‡Ωò‡ºã‡ΩÇ‡Ω§‡Ω≤‡Ω¶‡ºã‡ΩÇ‡æ≤‡ΩÑ‡ºã‡Ωò‡Ωº‡ºã‡ΩÜ‡ΩÇ‡Ω¶‡ºç", a: "‡Ωî‡Ω¶", opts: ["‡Ωî‡Ω¶", "‡Ωì‡Ω¶", "‡Ω£‡Ω¶", "‡ΩÄ‡æ±‡Ω≤"], expl: "‡Ω¢‡æí‡æ±‡Ω¥‡ºã‡Ωò‡Ωö‡Ωì‡ºã‡Ω¶‡æü‡Ωº‡Ωì‡ºã‡Ωî‡Ω†‡Ω≤‡ºã‡Ωï‡æ≤‡Ωë‡ºã‡Ωë‡ΩÇ‡Ωº‡Ω¶‡ºç" },
                { q: "‡Ωñ‡Ωº‡Ωë‡ºã ____ ‡Ω¢‡Ω≤‡ºã‡Ωò‡Ωê‡Ωº‡Ωì‡ºã‡Ωî‡Ωº‡ºã‡Ωò‡ΩÑ‡ºã‡Ωî‡Ωº‡ºã‡Ω°‡Ωº‡Ωë‡ºç", a: "‡Ω£‡ºã", opts: ["‡Ω£‡ºã", "‡Ωì‡Ω¶", "‡Ω£‡Ω¶", "‡ΩÇ‡Ω≤"], expl: "‡Ω¢‡æü‡Ω∫‡Ωì‡ºã‡ΩÇ‡Ωì‡Ω¶‡ºã‡ΩÄ‡æ±‡Ω≤‡ºã‡Ωë‡Ωº‡Ωì‡ºã‡Ω¶‡æü‡Ωº‡Ωì‡ºã‡Ωî‡Ω¶‡ºã '‡Ω£‡ºã' ‡Ω†‡Ωá‡Ω¥‡ΩÇ" },
                { q: "‡ΩÅ‡Ωº‡ΩÑ‡ºã‡ΩÇ‡Ω≤‡Ω¶‡ºã‡Ωë‡Ωî‡Ω∫‡ºã‡ΩÜ‡ºã‡ΩÄ‡æ≥‡Ωº‡ΩÇ‡ºã ____ ‡Ωñ‡Ω¶‡æ°‡Ωë‡ºç", a: "‡ΩÇ‡Ω≤‡Ωì‡ºã", opts: ["‡ΩÇ‡Ω≤‡Ωì‡ºã", "‡Ωì‡Ω≤", "‡Ωë‡ΩÑ‡ºã", "‡Ω£"], expl: "‡Ωñ‡æ±‡ºã‡Ωñ‡ºã‡Ωë‡ºã‡Ω£‡æü‡ºã‡Ωñ‡ºã‡Ω¶‡æü‡Ωº‡Ωì‡ºã‡Ωî‡Ω†‡Ω≤‡ºã‡Ωï‡æ≤‡Ωë‡ºã‡Ωë‡ΩÇ‡Ωº‡Ω¶‡ºç" },
                { q: "‡Ωò‡Ω∫‡ºã‡Ωè‡Ωº‡ΩÇ‡ºã‡Ωò‡Ωõ‡Ω∫‡Ω¶‡ºã‡Ωî‡Ωº‡ºã ____ ‡Ω¶‡æê‡æ±‡Ω∫‡Ω¶‡ºã‡Ω†‡Ωë‡Ω¥‡ΩÇ", a: "‡Ωû‡Ω≤‡ΩÇ‡ºã", opts: ["‡Ωû‡Ω≤‡ΩÇ‡ºã", "‡Ω§‡Ω≤‡ΩÇ", "‡ΩÖ‡Ω≤‡ΩÇ", "‡Ωì‡Ω≤"], expl: "‡ΩÇ‡ºã‡Ωë‡ºã‡Ωñ‡ºã‡Ω¶‡ºã‡Ωë‡ΩÑ‡ºã‡Ωò‡Ωê‡Ω†‡ºã‡Ωò‡Ω∫‡Ωë‡ºã‡Ωò‡Ωê‡Ω¢‡ºç ‡ºç‡Ωû‡Ω≤‡ΩÇ‡ºã‡Ω¶‡æü‡Ω∫‡ºã... (‡Ωò‡Ω≤‡ΩÑ‡ºã‡Ωò‡Ωê‡Ω†‡ºã‡Ω¶‡æ¶‡æ±‡Ωº‡Ω¢‡ºã‡Ωñ)" }
            ];
            
            const t = templates[Math.floor(Math.random() * templates.length)];
            return {
                prompt: "‡Ωö‡Ω≤‡ΩÇ‡ºã‡Ω¶‡æí‡æ≤‡Ω¥‡Ωñ‡ºã‡Ω†‡Ωë‡Ω≤‡Ω†‡Ω≤‡ºã‡Ωì‡ΩÑ‡ºã‡Ω£‡ºã‡Ω¢‡Ωì‡ºã‡Ωî‡Ω†‡Ω≤‡ºã‡Ωï‡æ≤‡Ωë‡ºã‡Ω†‡Ωë‡Ω∫‡Ωò‡Ω¶‡ºã‡Ω¢‡Ωº‡ΩÇ‡Ω¶‡ºç",
                questionHtml: t.q,
                answer: t.a,
                options: t.opts.sort(() => Math.random() - 0.5),
                explanation: t.expl
            };
        }

        // Level 4: Complex Syntax (Lhag-chas & rgyan-sdud)
        function generateLevel4() {
             const allWords = Object.values(suffixes).flat();
             const word = allWords[Math.floor(Math.random() * allWords.length)];
             const suffix = identifySuffix(word);
             const lhagchas = grammarRules.getLhagChas(suffix);
             
             // Randomly choose between Lhag-chas or rgyan-sdud logic
             // For simplicity in this demo, strictly practicing Lhag-chas construction
             const options = ['‡Ωè‡Ω∫', '‡Ωë‡Ω∫', '‡Ω¶‡æü‡Ω∫'].sort(() => Math.random() - 0.5);
             
             return {
                 prompt: "‡Ωò‡Ωö‡Ωò‡Ω¶‡ºã‡Ω¶‡æ¶‡æ±‡Ωº‡Ω¢‡ºã‡ΩÇ‡æ±‡Ω≤‡ºã‡Ω£‡æ∑‡ΩÇ‡ºã‡Ωñ‡ΩÖ‡Ω¶‡ºã‡ΩÄ‡æ±‡Ω≤‡ºã‡Ωï‡æ≤‡Ωë‡ºã‡ΩÇ‡ΩÑ‡ºã‡Ωû‡Ω≤‡ΩÇ‡ºã‡Ω†‡Ωê‡Ωº‡Ωñ‡ºã‡Ωñ‡Ωò‡ºç",
                 questionHtml: `${word}____ ‡Ωñ‡Ω§‡Ωë‡ºç`,
                 answer: lhagchas,
                 options: options,
                 explanation: `‡Ω¢‡æó‡Ω∫‡Ω¶‡ºã‡Ω†‡Ωá‡Ω¥‡ΩÇ‡ºã '${suffix}' ‡Ω£‡ºã‡Ω£‡æ∑‡ΩÇ‡ºã‡Ωñ‡ΩÖ‡Ω¶‡ºã '${lhagchas}' ‡Ω†‡Ωê‡Ωº‡Ωñ‡ºç`
             };
        }

        // Level 5: Proofreading (Error Correction)
        function generateLevel5() {
            const errors = [
                { 
                    realQ: "‡ΩÅ‡Ωº‡ΩÑ‡ºã‡ΩÇ‡Ω≤‡ºã‡Ωï‡æ±‡ΩÇ‡ºã‡Ω£‡Ω¶‡ºã‡ΩÇ‡Ωì‡ΩÑ‡ºã‡ºç",
                    ans: "‡ΩÅ‡Ωº‡ΩÑ‡ºã‡ΩÇ‡Ω≤‡Ω¶‡ºã",
                    opts: ["‡ΩÅ‡Ωº‡ΩÑ‡ºã‡ΩÇ‡Ω≤‡ºã", "‡ΩÅ‡Ωº‡ΩÑ‡ºã‡ΩÇ‡Ω≤‡Ω¶‡ºã", "‡ΩÅ‡Ωº‡ΩÑ‡ºã‡Ω£"],
                    expl: "‡Ωñ‡æ±‡ºã‡Ωñ‡ºã‡Ωñ‡æ±‡Ω∫‡Ωë‡ºã‡Ωò‡ΩÅ‡Ωì‡ºã‡Ω°‡Ω≤‡Ωì‡ºã‡Ωî‡Ω¶‡ºã‡Ωñ‡æ±‡Ω∫‡Ωë‡ºã‡Ω¶‡æí‡æ≤‡ºã '‡ΩÇ‡Ω≤‡Ω¶‡ºã' ‡Ωë‡ΩÇ‡Ωº‡Ω¶‡ºç" 
                },
                {
                    realQ: "‡ΩÑ‡ºã‡Ωì‡ΩÑ‡ºã‡Ω£‡Ω¶‡ºã‡Ω°‡Ωº‡ΩÑ‡ºã‡Ωñ‡ºã‡Ω°‡Ω≤‡Ωì‡ºç",
                    ans: "‡Ωì‡ΩÑ‡ºã‡Ωì‡Ω¶‡ºã",
                    opts: ["‡Ωì‡ΩÑ‡ºã‡Ωì‡Ω¶‡ºã", "‡Ωì‡ΩÑ‡ºã‡Ω£‡Ω¶‡ºã", "‡Ωì‡ΩÑ‡ºã‡ΩÇ‡Ω≤"],
                    expl: "‡Ω†‡Ωñ‡æ±‡Ω¥‡ΩÑ‡ºã‡ΩÅ‡Ω¥‡ΩÑ‡Ω¶‡ºã‡Ω°‡Ω≤‡Ωì‡ºã‡Ωî‡Ω¶‡ºã '‡Ωì‡Ω¶‡ºã' ‡Ωë‡ΩÇ‡Ωº‡Ω¶‡ºç '‡Ω£‡Ω¶‡ºã' ‡Ωì‡Ω≤‡ºã‡Ωë‡ΩÇ‡Ω¢‡ºã‡Ωñ‡ºã‡Ω£‡ºã‡Ω†‡Ωá‡Ω¥‡ΩÇ"
                },
                {
                    realQ: "‡ΩÅ‡æ±‡Ω∫‡Ωë‡ºã‡Ω¢‡ΩÑ‡ºã‡Ω£‡ºã‡Ω°‡Ωº‡Ωì‡ºã‡Ωè‡Ωì‡ºã‡Ω°‡Ωº‡Ωë‡ºã‡Ω¶‡æü‡Ω∫‡ºç",
                    ans: "‡Ω°‡Ωº‡Ωë‡ºã‡Ωë‡Ω∫",
                    opts: ["‡Ω°‡Ωº‡Ωë‡ºã‡Ωë‡Ω∫", "‡Ω°‡Ωº‡Ωë‡ºã‡Ωè‡Ω∫", "‡Ω°‡Ωº‡Ωë‡ºã‡Ω¶‡æü‡Ω∫"],
                    expl: "‡Ωë‡ºã‡Ωò‡Ωê‡Ω¢‡ºã‡Ω£‡æ∑‡ΩÇ‡ºã‡Ωñ‡ΩÖ‡Ω¶‡ºã '‡Ωë‡Ω∫‡ºã' ‡Ω†‡Ωê‡Ωº‡Ωñ‡ºç '‡Ω¶‡æü‡Ω∫‡ºã' ‡Ωì‡Ω≤‡ºã‡ΩÇ‡ºã‡ΩÑ‡ºã‡Ωñ‡ºã‡Ωò‡ºã‡Ω†‡ºã‡Ωò‡Ωê‡Ω¢‡ºã‡Ω†‡Ωê‡Ωº‡Ωñ‡ºç"
                },
                {
                    realQ: "‡Ωñ‡ΩÄ‡æ≤‡ºã‡Ω§‡Ω≤‡Ω¶‡ºã‡ΩÇ‡Ω≤‡ºã‡Ω£‡ΩÇ‡ºã‡Ωî‡Ω¢‡ºã‡Ωë‡Ω∫‡Ωñ‡ºã‡Ω°‡Ωº‡Ωë‡ºç",
                    ans: "‡Ωñ‡ΩÄ‡æ≤‡ºã‡Ω§‡Ω≤‡Ω¶‡ºã‡ΩÄ‡æ±‡Ω≤‡ºã",
                    opts: ["‡Ωñ‡ΩÄ‡æ≤‡ºã‡Ω§‡Ω≤‡Ω¶‡ºã‡ΩÄ‡æ±‡Ω≤‡ºã", "‡Ωñ‡ΩÄ‡æ≤‡ºã‡Ω§‡Ω≤‡Ω¶‡ºã‡ΩÇ‡Ω≤‡ºã", "‡Ωñ‡ΩÄ‡æ≤‡ºã‡Ω§‡Ω≤‡Ω¶‡ºã‡ΩÇ‡æ±‡Ω≤"],
                    expl: "‡Ω¶‡ºã‡Ωò‡Ωê‡Ω¢‡ºã‡Ω†‡Ωñ‡æ≤‡Ω∫‡Ω£‡ºã‡Ω¶‡æí‡æ≤‡ºã '‡ΩÄ‡æ±‡Ω≤‡ºã' ‡Ω†‡Ωê‡Ωº‡Ωñ‡ºç"
                },
                {
                    realQ: "‡ΩÜ‡Ω¥‡ºã‡Ωë‡Ω∫‡ºã‡ΩÑ‡ºã‡Ω£‡Ω¶‡ºã‡Ωñ‡Ωè‡Ω¥‡ΩÑ‡Ω¶‡ºã‡Ωî‡ºã‡Ω°‡Ω≤‡Ωì‡ºç",
                    ans: "‡ΩÑ‡Ω¶",
                    opts: ["‡ΩÑ‡Ω¶", "‡ΩÑ‡ºã‡Ω£‡Ω¶", "‡ΩÑ‡ºã‡Ω£"],
                    expl: "‡Ωñ‡æ±‡ºã‡Ωñ‡ºã‡Ωñ‡æ±‡Ω∫‡Ωë‡ºã‡Ωî‡Ωº‡ºã‡Ω°‡Ω≤‡Ωì‡ºã‡Ωî‡Ω¶‡ºã‡Ωñ‡æ±‡Ω∫‡Ωë‡ºã‡Ω¶‡æí‡æ≤‡ºã '‡ΩÑ‡Ω¶' (‡ΩÑ‡ºã‡Ω°‡Ω≤‡Ω¶‡ºã) ‡Ωë‡ΩÇ‡Ωº‡Ω¶‡ºç"
                },
                {
                    realQ: "‡ΩÇ‡æ≤‡Ωº‡ΩÑ‡ºã‡ΩÅ‡æ±‡Ω∫‡Ω¢‡ºã‡ΩÇ‡æ±‡Ω≤‡ºã‡Ωñ‡ΩÄ‡Ωº‡Ωë‡ºã‡Ωî‡ºã‡Ωò‡Ωõ‡Ω∫‡Ω¶‡ºã‡Ωè‡Ωº‡ºç",
                    ans: "‡Ωò‡Ωõ‡Ω∫‡Ω¶‡ºã‡Ω¶‡Ωº",
                    opts: ["‡Ωò‡Ωõ‡Ω∫‡Ω¶‡ºã‡Ω¶‡Ωº", "‡Ωò‡Ωõ‡Ω∫‡Ω¶‡ºã‡Ωè‡Ωº", "‡Ωò‡Ωõ‡Ω∫‡Ω¶‡ºã‡ΩÑ‡Ωº"],
                    expl: "‡Ω¶‡ºã‡Ωò‡Ωê‡Ω¢‡ºã‡Ω¶‡æ≥‡Ω¢‡ºã‡Ωñ‡Ω¶‡æ°‡Ω¥‡ºã '‡Ω¶‡Ωº‡ºã' ‡Ω†‡Ωê‡Ωº‡Ωñ‡ºç"
                },
                {
                    realQ: "‡ΩÑ‡ºã‡Ωö‡Ωº‡ºã‡Ωë‡ΩÇ‡Ωº‡ΩÑ‡ºã‡Ωò‡Ωº‡ºã‡Ωì‡ΩÑ‡ºã‡Ωè‡Ω¥‡ºã‡Ω£‡Ωº‡ΩÇ‡ºã‡Ωî‡ºã‡Ω°‡Ω≤‡Ωì‡ºç",
                    ans: "‡Ωì‡ΩÑ‡ºã‡Ωë‡Ω¥‡ºã",
                    opts: ["‡Ωì‡ΩÑ‡ºã‡Ωë‡Ω¥‡ºã", "‡Ωì‡ΩÑ‡ºã‡Ωè‡Ω¥‡ºã", "‡Ωì‡ΩÑ‡ºã‡Ω¢‡Ω¥"],
                    expl: "‡ΩÑ‡ºã‡Ωò‡Ωê‡Ω¢‡ºã‡Ω£‡ºã‡Ωë‡Ωº‡Ωì‡ºã '‡Ωë‡Ω¥‡ºã' ‡Ω†‡Ωê‡Ωº‡Ωñ‡ºç '‡Ωè‡Ω¥‡ºã' ‡Ωì‡Ω≤‡ºã‡ΩÇ‡ºã‡Ωñ‡ºã‡Ωë‡ºã‡Ωë‡æ≤‡ΩÇ‡ºã‡Ωò‡Ωê‡Ω¢‡ºã‡Ω†‡Ωê‡Ωº‡Ωñ‡ºç"
                },
                {
                    realQ: "‡ΩÅ‡Ωº‡ΩÑ‡ºã‡Ω°‡Ω¢‡ºã‡Ω£‡ΩÑ‡Ω¶‡ºã‡Ω¶‡æü‡Ω∫‡ºã‡Ω¶‡æê‡Ωë‡ºã‡ΩÜ‡ºã‡Ωñ‡Ω§‡Ωë‡ºç",
                    ans: "‡Ω£‡ΩÑ‡Ω¶‡ºã‡Ωè‡Ω∫‡ºã",
                    opts: ["‡Ω£‡ΩÑ‡Ω¶‡ºã‡Ωè‡Ω∫‡ºã", "‡Ω£‡ΩÑ‡Ω¶‡ºã‡Ω¶‡æü‡Ω∫‡ºã", "‡Ω£‡ΩÑ‡Ω¶‡ºã‡Ωë‡Ω∫"],
                    expl: "‡Ω¶‡ºã‡Ωò‡Ωê‡Ω¢‡ºã‡Ω£‡æ∑‡ΩÇ‡ºã‡Ωñ‡ΩÖ‡Ω¶‡ºã '‡Ωè‡Ω∫‡ºã' ‡Ω†‡Ωê‡Ωº‡Ωñ‡ºç"
                },
                {
                    realQ: "‡Ω¢‡Ω≤‡ºã‡Ωñ‡Ωº‡ºã‡Ωò‡Ωê‡Ωº‡Ωì‡ºã‡Ωî‡Ωº‡ºã‡Ωñ‡Ωº‡ºã‡Ωû‡Ω≤‡ΩÇ‡ºã‡Ω†‡Ωë‡Ω¥‡ΩÇ",
                    ans: "‡Ωò‡Ωê‡Ωº‡Ωì‡ºã‡Ωî‡Ωº‡ºã",
                    opts: ["‡Ωò‡Ωê‡Ωº‡Ωì‡ºã‡Ωî‡Ωº‡ºã", "‡Ωò‡Ωê‡Ωº‡Ωì‡ºã‡Ωî‡Ωº‡ºã‡Ωñ‡Ωº‡ºã", "‡Ωò‡Ωê‡Ωº‡Ωì‡ºã‡Ωî‡Ωº‡ºã‡Ωî‡Ωº"],
                    expl: "‡Ωò‡Ω≤‡ΩÑ‡ºã‡Ωò‡Ωê‡Ω†‡ºã‡Ωü‡æ≥‡Ωº‡Ω¶‡ºã‡Ω¶‡æê‡æ±‡Ωº‡Ωì‡ºã‡Ωñ‡æ±‡Ω¥‡ΩÑ‡ºã‡Ω†‡Ωë‡Ω¥‡ΩÇ '‡Ωî‡Ωº‡ºã' ‡ΩÇ‡ΩÖ‡Ω≤‡ΩÇ‡ºã‡ΩÇ‡Ω≤‡Ω¶‡ºã‡ΩÜ‡Ωº‡ΩÇ"
                },
                {
                    realQ: "‡ΩÅ‡Ωº‡ΩÑ‡ºã‡ΩÇ‡Ω≤‡ºã‡Ωì‡ΩÑ‡ºã‡Ω£‡ºã‡Ωï‡æ±‡Ω≤‡Ωì‡ºã‡Ωî‡ºã‡Ω°‡Ω≤‡Ωì‡ºç",
                    ans: "‡ΩÅ‡Ωº‡ΩÑ‡ºã‡ΩÇ‡Ω≤‡ºã",
                    opts: ["‡ΩÅ‡Ωº‡ΩÑ‡ºã‡ΩÇ‡Ω≤‡ºã", "‡ΩÅ‡Ωº‡ΩÑ‡ºã‡ΩÇ‡Ω≤‡Ω¶‡ºã", "‡ΩÅ‡Ωº‡ΩÑ‡ºã‡Ωì‡Ω¶"],
                    expl: "'‡ΩÅ‡Ωº‡ΩÑ‡ºã‡ΩÇ‡Ω≤‡Ω¶‡ºã‡Ωì‡ΩÑ‡ºã‡Ω£‡ºã‡Ωï‡æ±‡Ω≤‡Ωì‡ºã' ‡Ωò‡Ω≤‡ºã‡Ωü‡Ω∫‡Ω¢‡ºç ‡Ω†‡ΩÇ‡æ≤‡Ωº‡ºã‡Ωò‡ΩÅ‡Ωì‡ºã '‡ΩÑ‡ºã' ‡Ω°‡Ω≤‡Ωì‡ºã‡Ωî‡Ω¶‡ºã‡Ω†‡Ωñ‡æ≤‡Ω∫‡Ω£‡ºã‡Ω¶‡æí‡æ≤‡ºã '‡ΩÇ‡Ω≤‡ºã' ‡Ω†‡ΩÇ‡æ≤‡Ω≤‡ΩÇ" 
                    // Wait, this isn't an error correction if it's correct. Let's make an error.
                    // Correction below in replacement logic.
                },
                {
                    realQ: "‡Ω§‡Ω≤‡ΩÑ‡ºã‡Ωè‡Ωº‡ΩÇ‡ºã‡Ω†‡Ωë‡Ω≤‡ºã‡Ωû‡Ω≤‡Ωò‡ºã‡Ωî‡Ωº‡ºã‡Ωò‡Ω≤‡ºã‡Ω†‡Ωë‡Ω¥‡ΩÇ‡ºã‡Ω°‡ΩÑ‡ºã‡Ωò‡Ωë‡Ωº‡ΩÇ‡ºã‡Ωò‡Ωõ‡Ω∫‡Ω¶‡ºç",
                    ans: "‡Ω†‡Ωë‡Ω¥‡ΩÇ‡ºã‡ΩÄ‡æ±‡ΩÑ‡ºã",
                    opts: ["‡Ω†‡Ωë‡Ω¥‡ΩÇ‡ºã‡ΩÄ‡æ±‡ΩÑ‡ºã", "‡Ω†‡Ωë‡Ω¥‡ΩÇ‡ºã‡Ω°‡ΩÑ‡ºã", "‡Ω†‡Ωë‡Ω¥‡ΩÇ‡ºã‡Ω†‡ΩÑ"],
                    expl: "‡ΩÇ‡ºã‡Ωò‡Ωê‡Ω¢‡ºã‡Ω¢‡æí‡æ±‡Ωì‡ºã‡Ω¶‡æ°‡Ω¥‡Ωë‡ºã '‡ΩÄ‡æ±‡ΩÑ‡ºã' ‡Ω†‡Ωê‡Ωº‡Ωñ‡ºç"
                }
            ];
            
            const t = errors[Math.floor(Math.random() * errors.length)];
            
            // Fix logic for the "Khong gi nang la" case to ensure it's a test
            if(t.realQ.includes("‡ΩÅ‡Ωº‡ΩÑ‡ºã‡ΩÇ‡Ω≤‡ºã‡Ωì‡ΩÑ‡ºã‡Ω£‡ºã")) {
                 t.realQ = "‡ΩÅ‡Ωº‡ΩÑ‡ºã‡ΩÇ‡Ω≤‡Ω¶‡ºã‡Ωì‡ΩÑ‡ºã‡Ω£‡ºã‡Ωï‡æ±‡Ω≤‡Ωì‡ºã‡Ωî‡ºã‡Ω°‡Ω≤‡Ωì‡ºç"; // Error: Khong-gis went home? No, usually Khong nang la phyin. Or Nga khong gi nang la.
                 t.ans = "‡ΩÅ‡Ωº‡ΩÑ‡ºã";
                 t.opts = ["‡ΩÅ‡Ωº‡ΩÑ‡ºã", "‡ΩÅ‡Ωº‡ΩÑ‡ºã‡ΩÇ‡Ω≤‡Ω¶‡ºã", "‡ΩÅ‡Ωº‡ΩÑ‡ºã‡Ω£"];
                 t.expl = "‡Ω†‡ΩÇ‡æ≤‡Ωº‡ºã‡Ωò‡ΩÅ‡Ωì‡ºã‡ΩÇ‡Ωô‡Ωº‡ºã‡Ωñ‡Ωº‡ºã‡Ω°‡Ω≤‡Ωì‡ºã‡Ωî‡Ω¶‡ºã‡Ωñ‡æ±‡Ω∫‡Ωë‡ºã‡Ω¶‡æí‡æ≤‡ºã‡Ωò‡Ω≤‡ºã‡Ωë‡ΩÇ‡Ωº‡Ω¶‡ºç ‡Ω°‡ΩÑ‡ºã‡Ωì‡ºã '‡ΩÅ‡Ωº‡ΩÑ‡ºã‡ΩÇ‡Ω≤‡Ω¶‡ºã...‡Ωï‡æ±‡Ω≤‡Ωì‡ºã' ‡Ωû‡Ω∫‡Ω¶‡ºã‡Ωî‡ºã‡Ωñ‡Ω¢‡æ°‡ºã‡Ω¶‡æ§‡æ≤‡Ωº‡Ωë‡ºã‡Ωë‡ΩÑ‡ºã‡Ωò‡Ω≤‡ºã‡Ωò‡Ωê‡Ω¥‡Ωì‡ºç";
            }

            return {
                prompt: "‡ΩÇ‡Ω§‡Ωò‡ºã‡ΩÇ‡æ±‡Ω≤‡ºã‡Ωö‡Ω≤‡ΩÇ‡ºã‡Ωë‡Ω∫‡Ω†‡Ω≤‡ºã‡Ωì‡ΩÑ‡ºã‡ΩÇ‡Ω≤‡ºã‡Ωì‡Ωº‡Ω¢‡ºã‡Ω†‡ΩÅ‡æ≤‡Ω¥‡Ω£‡ºã‡Ωë‡Ω∫‡ºã‡Ωñ‡ΩÖ‡Ωº‡Ω¶‡ºã‡Ω¢‡Ωº‡ΩÇ‡Ω¶‡ºç",
                questionHtml: t.realQ,
                answer: t.ans,
                options: t.opts.sort(() => Math.random() - 0.5),
                explanation: t.expl
            };
        }


        // --- 3. GAME STATE MANAGEMENT ---

        let gameState = {
            level: 1,
            score: 0,
            questionsCount: 0,
            streak: 0,
            currentQ: null,
            maxQuestionsPerLevel: 5
        };

        const ui = {
            questionContainer: document.getElementById('question-container'),
            questionPrompt: document.getElementById('question-prompt'),
            questionDisplay: document.getElementById('question-display'),
            optionsGrid: document.getElementById('options-grid'),
            score: document.getElementById('score-display'),
            progressBar: document.getElementById('progress-bar'),
            levelBadge: document.getElementById('level-badge'),
            feedbackOverlay: document.getElementById('feedback-overlay'),
            feedbackTitle: document.getElementById('feedback-title'),
            feedbackText: document.getElementById('feedback-text'),
            feedbackIcon: document.getElementById('feedback-icon'),
            nextBtn: document.getElementById('next-btn'),
            levelComplete: document.getElementById('level-complete'),
            nextLevelBtn: document.getElementById('next-level-btn')
        };

        function initGame() {
            gameState.level = 1;
            gameState.score = 0;
            gameState.streak = 0;
            updateUI();
            loadQuestion();
        }

        function updateUI() {
            ui.score.innerText = gameState.score;
            ui.levelBadge.innerText = `‡Ω¢‡Ω≤‡Ωò‡ºã‡Ωî‡ºã ${gameState.level} ‡Ωî‡ºç Level ${gameState.level}`;
            const progress = (gameState.questionsCount / gameState.maxQuestionsPerLevel) * 100;
            ui.progressBar.style.width = `${progress}%`;
        }

        function loadQuestion() {
            ui.feedbackOverlay.classList.add('hidden');
            ui.questionContainer.classList.remove('hidden');
            
            // Generate based on level
            let qData;
            switch(gameState.level) {
                case 1: qData = generateLevel1(); break;
                case 2: qData = generateLevel2(); break;
                case 3: qData = generateLevel3(); break;
                case 4: qData = generateLevel4(); break;
                case 5: qData = generateLevel5(); break;
                default: qData = generateLevel1(); // Fallback or loop
            }

            gameState.currentQ = qData;
            
            // Render
            ui.questionPrompt.innerText = qData.prompt;
            ui.questionDisplay.innerHTML = qData.questionHtml;
            ui.optionsGrid.innerHTML = '';
            
            qData.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = "bg-white border-2 border-indigo-100 hover:border-indigo-400 text-2xl font-bold py-6 rounded-xl shadow-sm hover:shadow-md transition-all text-gray-700 active:scale-95";
                btn.innerText = opt;
                btn.onclick = () => handleAnswer(opt, btn);
                ui.optionsGrid.appendChild(btn);
            });
        }

        function handleAnswer(selection, btnElement) {
            const isCorrect = selection === gameState.currentQ.answer;
            
            // Disable all buttons
            const allBtns = ui.optionsGrid.querySelectorAll('button');
            allBtns.forEach(b => b.disabled = true);

            if (isCorrect) {
                gameState.score += 10 + (gameState.streak * 2);
                gameState.streak++;
                btnElement.classList.add('correct-anim');
                showFeedback(true);
            } else {
                gameState.streak = 0;
                btnElement.classList.add('wrong-anim');
                // Highlight correct one
                allBtns.forEach(b => {
                    if (b.innerText === gameState.currentQ.answer) b.classList.add('bg-green-100', 'border-green-500');
                });
                showFeedback(false);
            }
            updateUI();
        }

        function showFeedback(isCorrect) {
            setTimeout(() => {
                ui.feedbackOverlay.classList.remove('hidden');
                ui.feedbackTitle.innerText = isCorrect ? "‡Ω†‡ΩÇ‡æ≤‡Ω≤‡ΩÇ‡ºã‡Ω¶‡Ωº‡ΩÑ‡ºã‡ºç Correct!" : "‡Ωì‡Ωº‡Ω¢‡ºã‡Ω¶‡Ωº‡ΩÑ‡ºã‡ºç Incorrect";
                ui.feedbackTitle.className = isCorrect ? "text-2xl font-bold mb-2 text-green-600" : "text-2xl font-bold mb-2 text-red-600";
                ui.feedbackIcon.innerText = isCorrect ? "üéâ" : "‚ùå";
                ui.feedbackText.innerText = gameState.currentQ.explanation;
            }, 600);
        }

        ui.nextBtn.onclick = () => {
            gameState.questionsCount++;
            
            if (gameState.questionsCount >= gameState.maxQuestionsPerLevel) {
                levelComplete();
            } else {
                loadQuestion();
            }
        };

        function levelComplete() {
            ui.questionContainer.classList.add('hidden');
            ui.feedbackOverlay.classList.add('hidden');
            ui.levelComplete.classList.remove('hidden');
        }

        ui.nextLevelBtn.onclick = () => {
            gameState.level++;
            if (gameState.level > 5) gameState.level = 1; // Loop back or end game
            gameState.questionsCount = 0;
            ui.levelComplete.classList.add('hidden');
            loadQuestion();
            updateUI();
        };

        // Start
        initGame();

    </script>
</body>
</html>